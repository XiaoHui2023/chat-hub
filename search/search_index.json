{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Chat Hub","text":"<p>\u7edf\u4e00\u804a\u5929\u6d88\u606f\u8def\u7531\u4e2d\u5fc3</p> <p>Chat Hub \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u804a\u5929\u6d88\u606f\u8def\u7531\u6846\u67b6\uff0c\u8d1f\u8d23\u5c06\u804a\u5929\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u7684 Bot \u5904\u7406\u51fd\u6570\uff0c\u5e76\u7edf\u4e00\u7ba1\u7406\u4f1a\u8bdd\u4e0e\u6d88\u606f\u534f\u8bae\u3002</p>"},{"location":"#_1","title":"\u7279\u6027","text":"<ul> <li>\u7edf\u4e00\u534f\u8bae \u2014 \u5b9a\u4e49\u4e86\u5b8c\u6574\u7684\u804a\u5929\u534f\u8bae\uff08\u6d88\u606f\u3001\u4e8b\u4ef6\u3001\u547d\u4ee4\uff09\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u5171\u4eab\u540c\u4e00\u5957\u6570\u636e\u7ed3\u6784</li> <li>\u591a\u5a92\u4f53\u6d88\u606f \u2014 \u652f\u6301\u6587\u672c\u3001\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u3001\u6587\u4ef6\u7b49\u591a\u79cd\u6d88\u606f\u7c7b\u578b\uff0c\u5929\u7136\u652f\u6301\u56fe\u6587\u6df7\u6392</li> <li>\u6d88\u606f\u8def\u7531 \u2014 \u901a\u8fc7 <code>bot_id</code> \u5c06\u8bf7\u6c42\u8def\u7531\u5230\u5bf9\u5e94\u7684 Bot \u5904\u7406\u51fd\u6570</li> <li>\u6d41\u5f0f\u54cd\u5e94 \u2014 \u5185\u7f6e\u6d41\u5f0f\u4e8b\u4ef6\u7c7b\u578b\uff08<code>STREAM_START</code> / <code>STREAM_DELTA</code> / <code>STREAM_END</code>\uff09</li> <li>\u547d\u4ee4\u7cfb\u7edf \u2014 \u652f\u6301\u6e05\u9664\u4e0a\u4e0b\u6587\u3001\u6e05\u9664\u8bb0\u5fc6\u3001\u8bbe\u7f6e\u53c2\u6570\u7b49\u63a7\u5236\u547d\u4ee4</li> <li>\u7c7b\u578b\u5b89\u5168 \u2014 \u57fa\u4e8e Pydantic v2 \u6784\u5efa\uff0c\u5b8c\u6574\u7684\u7c7b\u578b\u6821\u9a8c\u4e0e\u5e8f\u5217\u5316\u652f\u6301</li> </ul>"},{"location":"#_2","title":"\u9879\u76ee\u7ed3\u6784","text":"<pre><code>chat-hub/\n\u251c\u2500\u2500 chat_hub/                      # \u4e3b\u5e94\u7528\n\u2502   \u251c\u2500\u2500 main.py                    # \u5e94\u7528\u5165\u53e3\n\u2502   \u251c\u2500\u2500 hub.py                     # Hub \u8def\u7531\u6838\u5fc3\n\u2502   \u2514\u2500\u2500 config.py                  # \u5e94\u7528\u914d\u7f6e\n\u251c\u2500\u2500 packages/\n\u2502   \u2514\u2500\u2500 protocol/                  # \u534f\u8bae\u5305\uff08\u53ef\u72ec\u7acb\u53d1\u5e03\uff09\n\u2502       \u2514\u2500\u2500 chat_hub_protocol/\n\u2502           \u251c\u2500\u2500 chat.py            # \u804a\u5929\u6570\u636e\u7ed3\u6784\n\u2502           \u251c\u2500\u2500 message.py         # \u6d88\u606f\u7c7b\u578b\u5b9a\u4e49\n\u2502           \u2514\u2500\u2500 command.py         # \u547d\u4ee4\u534f\u8bae\u5b9a\u4e49\n\u2514\u2500\u2500 tests/\n    \u2514\u2500\u2500 test_protocol.py           # \u534f\u8bae\u5355\u5143\u6d4b\u8bd5\n</code></pre>"},{"location":"#_3","title":"\u6280\u672f\u6808","text":"\u7ec4\u4ef6 \u6280\u672f \u6570\u636e\u6a21\u578b Pydantic v2 \u914d\u7f6e\u7ba1\u7406 pydantic-settings Python \u7248\u672c &gt;= 3.11 \u6784\u5efa\u5de5\u5177 Hatchling \u4ee3\u7801\u68c0\u67e5 Ruff \u6d4b\u8bd5\u6846\u67b6 pytest"},{"location":"architecture/","title":"\u67b6\u6784\u6982\u89c8","text":""},{"location":"architecture/#_2","title":"\u6574\u4f53\u67b6\u6784","text":"<p>Chat Hub \u91c7\u7528\u5355\u4f53\u4ed3\u5e93\uff08monorepo\uff09 \u7ed3\u6784\uff0c\u5305\u542b\u4e24\u4e2a\u4e3b\u8981\u90e8\u5206\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  \u5ba2\u6237\u7aef                       \u2502\n\u2502         (\u4f7f\u7528 chat-hub-protocol)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502  ChatPayload / CommandPayload\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Chat Hub \u670d\u52a1                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502              Hub \u8def\u7531               \u2502    \u2502\n\u2502  \u2502  \u2022 \u6ce8\u518c/\u6ce8\u9500 Bot                    \u2502    \u2502\n\u2502  \u2502  \u2022 \u6839\u636e bot_id \u5206\u53d1\u8bf7\u6c42            \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502         \u2502          \u2502          \u2502             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502 Bot A  \u2502 \u2502 Bot B  \u2502 \u2502 Bot C  \u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502         \u2502          \u2502          \u2502             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502          \u2502          \u2502\n          \u25bc          \u25bc          \u25bc\n      ChatEvent  ChatEvent  ChatEvent\n</code></pre>"},{"location":"architecture/#_3","title":"\u6838\u5fc3\u6a21\u5757","text":""},{"location":"architecture/#1-chat_hub_protocol","title":"1. \u534f\u8bae\u5c42 (<code>chat_hub_protocol</code>)","text":"<p>\u72ec\u7acb\u53ef\u53d1\u5e03\u7684\u534f\u8bae\u5305\uff0c\u5b9a\u4e49\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u7684\u516c\u5171\u6570\u636e\u7ed3\u6784\u3002</p> \u6a21\u5757 \u804c\u8d23 <code>chat.py</code> \u804a\u5929\u6838\u5fc3\u7c7b\u578b\uff1a<code>Message</code>\u3001<code>ChatPayload</code>\u3001<code>ChatEvent</code>\u3001<code>Role</code>\u3001<code>EventType</code> <code>message.py</code> \u6d88\u606f\u5185\u5bb9\u6bb5\uff1a<code>TextSegment</code>\u3001<code>ImageSegment</code>\u3001<code>AudioSegment</code>\u3001<code>VideoSegment</code>\u3001<code>FileSegment</code> <code>command.py</code> \u63a7\u5236\u547d\u4ee4\uff1a<code>ClearContextCommand</code>\u3001<code>ClearMemoryCommand</code>\u3001<code>SetContextLengthCommand</code>"},{"location":"architecture/#2-chat_hub","title":"2. \u5e94\u7528\u5c42 (<code>chat_hub</code>)","text":"\u6a21\u5757 \u804c\u8d23 <code>hub.py</code> Hub \u6838\u5fc3\uff0c\u7ba1\u7406 Bot \u6ce8\u518c\u548c\u6d88\u606f\u8def\u7531 <code>config.py</code> \u5e94\u7528\u914d\u7f6e\uff0c\u901a\u8fc7\u73af\u5883\u53d8\u91cf/<code>.env</code> \u52a0\u8f7d <code>main.py</code> \u5e94\u7528\u5165\u53e3"},{"location":"architecture/#_4","title":"\u6570\u636e\u6d41","text":""},{"location":"architecture/#_5","title":"\u804a\u5929\u6d41\u7a0b","text":"<pre><code>1. \u5ba2\u6237\u7aef\u6784\u5efa ChatPayload\uff08\u5305\u542b bot_id\u3001session_id\u3001message\uff09\n2. \u53d1\u9001\u5230 Chat Hub \u670d\u52a1\n3. Hub.dispatch() \u6839\u636e bot_id \u627e\u5230\u5bf9\u5e94\u7684 BotHandler\n4. BotHandler \u5904\u7406\u8bf7\u6c42\uff0c\u8fd4\u56de ChatEvent\n5. ChatEvent \u63a8\u9001\u7ed9\u5ba2\u6237\u7aef\n</code></pre>"},{"location":"architecture/#_6","title":"\u6d88\u606f\u6a21\u578b","text":"<p>\u4e00\u6761\u6d88\u606f (<code>Message</code>) \u7531\u591a\u4e2a\u5185\u5bb9\u6bb5 (<code>Segment</code>) \u7ec4\u6210\uff1a</p> <pre><code>Message\n\u251c\u2500\u2500 role: Role (user / assistant / system)\n\u251c\u2500\u2500 content: list[Segment]\n\u2502   \u251c\u2500\u2500 TextSegment(type=\"text\", text=\"\u4f60\u597d\")\n\u2502   \u251c\u2500\u2500 ImageSegment(type=\"image\", url=\"...\")\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 timestamp: datetime\n</code></pre> <p>\u901a\u8fc7 discriminated union\uff08\u57fa\u4e8e <code>type</code> \u5b57\u6bb5\uff09\u5b9e\u73b0\u7c7b\u578b\u5b89\u5168\u7684\u591a\u6001\u5e8f\u5217\u5316\u3002</p>"},{"location":"architecture/#_7","title":"\u4e8b\u4ef6\u7c7b\u578b","text":"\u4e8b\u4ef6 \u8bf4\u660e <code>MESSAGE</code> \u5b8c\u6574\u6d88\u606f\u54cd\u5e94 <code>STREAM_START</code> \u6d41\u5f0f\u54cd\u5e94\u5f00\u59cb <code>STREAM_DELTA</code> \u6d41\u5f0f\u54cd\u5e94\u589e\u91cf\u6587\u672c <code>STREAM_END</code> \u6d41\u5f0f\u54cd\u5e94\u7ed3\u675f\uff0c\u643a\u5e26\u5b8c\u6574\u6d88\u606f <code>ERROR</code> \u9519\u8bef\u4e8b\u4ef6"},{"location":"getting-started/","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"getting-started/#_2","title":"\u5b89\u88c5","text":""},{"location":"getting-started/#_3","title":"\u5b89\u88c5\u4e3b\u9879\u76ee","text":"<pre><code>git clone https://github.com/XiaoHui2023/chat-hub.git\ncd chat-hub\npip install -e .\n</code></pre>"},{"location":"getting-started/#_4","title":"\u4ec5\u5b89\u88c5\u534f\u8bae\u5305","text":"<p>\u5982\u679c\u4f60\u53ea\u9700\u8981\u4f7f\u7528\u534f\u8bae\u6570\u636e\u7ed3\u6784\uff08\u4f8b\u5982\u5728\u5ba2\u6237\u7aef\u9879\u76ee\u4e2d\uff09\uff0c\u53ef\u4ee5\u5355\u72ec\u5b89\u88c5\u534f\u8bae\u5305\uff1a</p> <pre><code>pip install chat-hub-protocol\n</code></pre>"},{"location":"getting-started/#_5","title":"\u57fa\u672c\u4f7f\u7528","text":""},{"location":"getting-started/#_6","title":"\u521b\u5efa\u6d88\u606f","text":"<pre><code>from chat_hub_protocol import Message, Role\n\n# \u521b\u5efa\u7eaf\u6587\u672c\u6d88\u606f\nmsg = Message.text(Role.USER, \"\u4f60\u597d\uff01\")\n</code></pre>"},{"location":"getting-started/#_7","title":"\u6784\u5efa\u804a\u5929\u8f7d\u8377","text":"<pre><code>from chat_hub_protocol import ChatPayload, Message, Role\n\nmsg = Message.text(Role.USER, \"\u4f60\u597d\uff01\")\npayload = ChatPayload(\n    bot_id=\"bot-001\",\n    session_id=\"sess-abc\",\n    message=msg,\n)\n\n# \u5e8f\u5217\u5316\u4e3a JSON\nprint(payload.model_dump_json(indent=2))\n</code></pre>"},{"location":"getting-started/#_8","title":"\u591a\u5a92\u4f53\u6d88\u606f\uff08\u56fe\u6587\u6df7\u6392\uff09","text":"<pre><code>from chat_hub_protocol import Message, Role, TextSegment, ImageSegment\n\nmsg = Message(\n    role=Role.USER,\n    content=[\n        TextSegment(text=\"\u8bf7\u770b\u8fd9\u5f20\u56fe\u7247\uff1a\"),\n        ImageSegment(url=\"https://example.com/photo.jpg\", alt=\"\u793a\u4f8b\u56fe\u7247\"),\n    ],\n)\n</code></pre>"},{"location":"getting-started/#bot","title":"\u6ce8\u518c Bot \u5e76\u5904\u7406\u6d88\u606f","text":"<pre><code>from chat_hub.hub import Hub\nfrom chat_hub_protocol import ChatPayload, ChatEvent, EventType, Message, Role\n\nhub = Hub()\n\nasync def my_bot(payload: ChatPayload) -&gt; ChatEvent:\n    \"\"\"\u4e00\u4e2a\u7b80\u5355\u7684\u56de\u58f0 Bot\u3002\"\"\"\n    return ChatEvent(\n        event=EventType.MESSAGE,\n        bot_id=payload.bot_id,\n        session_id=payload.session_id,\n        message=Message.text(Role.ASSISTANT, f\"\u6536\u5230: {payload.message.content}\"),\n        request_id=payload.request_id,\n    )\n\n# \u6ce8\u518c Bot\nhub.register(\"echo-bot\", my_bot)\n\n# \u5206\u53d1\u6d88\u606f\n# response = await hub.dispatch(payload)\n</code></pre>"},{"location":"getting-started/#_9","title":"\u53d1\u9001\u547d\u4ee4","text":"<pre><code>from chat_hub_protocol import (\n    CommandPayload,\n    ClearContextCommand,\n    SetContextLengthCommand,\n)\n\n# \u6e05\u9664\u4f1a\u8bdd\u4e0a\u4e0b\u6587\ncmd = CommandPayload(\n    bot_id=\"bot-001\",\n    session_id=\"sess-abc\",\n    command=ClearContextCommand(),\n)\n\n# \u8bbe\u7f6e\u4e0a\u4e0b\u6587\u957f\u5ea6\ncmd = CommandPayload(\n    bot_id=\"bot-001\",\n    session_id=\"sess-abc\",\n    command=SetContextLengthCommand(length=20),\n)\n</code></pre>"},{"location":"getting-started/#_10","title":"\u914d\u7f6e","text":"<p>Chat Hub \u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216 <code>.env</code> \u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\uff0c\u6240\u6709\u914d\u7f6e\u9879\u5747\u4ee5 <code>CHAT_HUB_</code> \u4e3a\u524d\u7f00\uff1a</p> \u73af\u5883\u53d8\u91cf \u9ed8\u8ba4\u503c \u8bf4\u660e <code>CHAT_HUB_HOST</code> <code>0.0.0.0</code> \u76d1\u542c\u5730\u5740 <code>CHAT_HUB_PORT</code> <code>8000</code> \u76d1\u542c\u7aef\u53e3 <code>CHAT_HUB_DEBUG</code> <code>false</code> \u8c03\u8bd5\u6a21\u5f0f <pre><code># .env \u6587\u4ef6\u793a\u4f8b\nCHAT_HUB_HOST=127.0.0.1\nCHAT_HUB_PORT=9000\nCHAT_HUB_DEBUG=true\n</code></pre>"},{"location":"api/config/","title":"\u914d\u7f6e","text":"<p>\u5e94\u7528\u914d\u7f6e\uff0c\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216 <code>.env</code> \u6587\u4ef6\u52a0\u8f7d\u3002\u6240\u6709\u914d\u7f6e\u9879\u5747\u4ee5 <code>CHAT_HUB_</code> \u4e3a\u524d\u7f00\u3002</p>"},{"location":"api/config/#settings","title":"Settings","text":""},{"location":"api/config/#chat_hub.config.Settings","title":"<code>Settings</code>","text":"<p>               Bases: <code>BaseSettings</code></p> <p>\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216 .env \u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\u3002</p>"},{"location":"api/hub/","title":"Hub \u8def\u7531","text":"<p>Hub \u662f Chat Hub \u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u7ba1\u7406 Bot \u6ce8\u518c\u548c\u6d88\u606f\u8def\u7531\u5206\u53d1\u3002</p>"},{"location":"api/hub/#hub_1","title":"Hub","text":""},{"location":"api/hub/#chat_hub.hub.Hub","title":"<code>Hub()</code>","text":"<p>\u7ba1\u7406\u5df2\u6ce8\u518c\u7684 Bot\uff0c\u5e76\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570\u3002</p> \u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1a <code>chat_hub/hub.py</code> <pre><code>def __init__(self) -&gt; None:\n    self._handlers: dict[str, BotHandler] = {}\n</code></pre>"},{"location":"api/hub/#chat_hub.hub.Hub.bot_ids","title":"<code>bot_ids</code>  <code>property</code>","text":"<p>\u8fd4\u56de\u6240\u6709\u5df2\u6ce8\u518c\u7684 Bot ID\u3002</p>"},{"location":"api/hub/#chat_hub.hub.Hub.register","title":"<code>register(bot_id, handler)</code>","text":"<p>\u6ce8\u518c\u4e00\u4e2a Bot \u5904\u7406\u51fd\u6570\u3002</p> \u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1a <code>chat_hub/hub.py</code> <pre><code>def register(self, bot_id: str, handler: BotHandler) -&gt; None:\n    \"\"\"\u6ce8\u518c\u4e00\u4e2a Bot \u5904\u7406\u51fd\u6570\u3002\"\"\"\n    if bot_id in self._handlers:\n        raise ValueError(f\"Bot '{bot_id}' \u5df2\u6ce8\u518c\")\n    self._handlers[bot_id] = handler\n</code></pre>"},{"location":"api/hub/#chat_hub.hub.Hub.unregister","title":"<code>unregister(bot_id)</code>","text":"<p>\u6ce8\u9500\u4e00\u4e2a Bot\u3002</p> \u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1a <code>chat_hub/hub.py</code> <pre><code>def unregister(self, bot_id: str) -&gt; None:\n    \"\"\"\u6ce8\u9500\u4e00\u4e2a Bot\u3002\"\"\"\n    self._handlers.pop(bot_id, None)\n</code></pre>"},{"location":"api/hub/#chat_hub.hub.Hub.dispatch","title":"<code>dispatch(payload)</code>  <code>async</code>","text":"<p>\u5c06\u804a\u5929\u8f7d\u8377\u5206\u53d1\u5230\u5bf9\u5e94\u7684 Bot \u5904\u7406\u51fd\u6570\u3002</p> \u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1a <code>chat_hub/hub.py</code> <pre><code>async def dispatch(self, payload: ChatPayload) -&gt; ChatEvent:\n    \"\"\"\u5c06\u804a\u5929\u8f7d\u8377\u5206\u53d1\u5230\u5bf9\u5e94\u7684 Bot \u5904\u7406\u51fd\u6570\u3002\"\"\"\n    handler = self._handlers.get(payload.bot_id)\n    if handler is None:\n        from chat_hub_protocol import EventType\n\n        return ChatEvent(\n            event=EventType.ERROR,\n            bot_id=payload.bot_id,\n            session_id=payload.session_id,\n            error=f\"\u672a\u627e\u5230 Bot: {payload.bot_id}\",\n            request_id=payload.request_id,\n        )\n    return await handler(payload)\n</code></pre>"},{"location":"api/hub/#bothandler","title":"BotHandler","text":""},{"location":"api/hub/#chat_hub.hub.BotHandler","title":"<code>BotHandler = Callable[[ChatPayload], Coroutine[Any, Any, ChatEvent]]</code>  <code>module-attribute</code>","text":""},{"location":"api/protocol/chat/","title":"\u804a\u5929\u534f\u8bae","text":"<p>Chat \u6838\u5fc3\u6570\u636e\u7ed3\u6784\uff0c\u5b9a\u4e49 <code>Message</code>\uff08\u5355\u6761\u6d88\u606f\uff09\u548c <code>ChatPayload</code>\uff08\u5b8c\u6574\u804a\u5929\u8f7d\u8377\uff09\uff0c\u4f9b\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u4f20\u8f93\u4f7f\u7528\u3002</p>"},{"location":"api/protocol/chat/#role","title":"Role","text":""},{"location":"api/protocol/chat/#chat_hub_protocol.Role","title":"<code>Role</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>\u6d88\u606f\u89d2\u8272\u3002</p>"},{"location":"api/protocol/chat/#message","title":"Message","text":""},{"location":"api/protocol/chat/#chat_hub_protocol.Message","title":"<code>Message</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u5355\u6761\u804a\u5929\u6d88\u606f\u3002</p> <p>\u4e00\u6761\u6d88\u606f\u7531\u591a\u4e2a Segment \u7ec4\u6210\uff0c\u5141\u8bb8\u56fe\u6587\u6df7\u6392\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.Message.role","title":"<code>role</code>  <code>instance-attribute</code>","text":"<p>\u53d1\u9001\u8005\u89d2\u8272\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.Message.content","title":"<code>content</code>  <code>instance-attribute</code>","text":"<p>\u6d88\u606f\u5185\u5bb9\u6bb5\u5217\u8868\uff0c\u652f\u6301\u56fe\u6587\u6df7\u6392\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.Message.timestamp","title":"<code>timestamp = Field(default_factory=(datetime.now))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u6d88\u606f\u65f6\u95f4\u6233\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.Message.text","title":"<code>text(role, text)</code>  <code>classmethod</code>","text":"<p>\u5feb\u6377\u521b\u5efa\u7eaf\u6587\u672c\u6d88\u606f\u3002</p> \u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1a <code>packages/protocol/chat_hub_protocol/chat.py</code> <pre><code>@classmethod\ndef text(cls, role: Role | str, text: str) -&gt; Message:\n    \"\"\"\u5feb\u6377\u521b\u5efa\u7eaf\u6587\u672c\u6d88\u606f\u3002\"\"\"\n    from .message import TextSegment\n\n    return cls(role=Role(role), content=[TextSegment(text=text)])\n</code></pre>"},{"location":"api/protocol/chat/#chatpayload","title":"ChatPayload","text":""},{"location":"api/protocol/chat/#chat_hub_protocol.ChatPayload","title":"<code>ChatPayload</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u4e00\u6b21\u804a\u5929\u8bf7\u6c42/\u4e8b\u4ef6\u7684\u5b8c\u6574\u8f7d\u8377\u3002</p> <p>\u5305\u542b bot \u6807\u8bc6\u3001\u4f1a\u8bdd\u6807\u8bc6\u4ee5\u53ca\u6d88\u606f\u5185\u5bb9\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatPayload.bot_id","title":"<code>bot_id</code>  <code>instance-attribute</code>","text":"<p>Bot \u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatPayload.session_id","title":"<code>session_id</code>  <code>instance-attribute</code>","text":"<p>\u4f1a\u8bdd\u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatPayload.message","title":"<code>message</code>  <code>instance-attribute</code>","text":"<p>\u672c\u6b21\u643a\u5e26\u7684\u6d88\u606f\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatPayload.request_id","title":"<code>request_id = Field(default_factory=(lambda: uuid4().hex))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u8bf7\u6c42\u552f\u4e00\u6807\u8bc6\uff0c\u7528\u4e8e\u94fe\u8def\u8ffd\u8e2a\u3002</p>"},{"location":"api/protocol/chat/#eventtype","title":"EventType","text":""},{"location":"api/protocol/chat/#chat_hub_protocol.EventType","title":"<code>EventType</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>\u4e8b\u4ef6\u7c7b\u578b\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.EventType.MESSAGE","title":"<code>MESSAGE = 'message'</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u666e\u901a\u6d88\u606f\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.EventType.STREAM_START","title":"<code>STREAM_START = 'stream_start'</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u6d41\u5f0f\u54cd\u5e94\u5f00\u59cb\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.EventType.STREAM_DELTA","title":"<code>STREAM_DELTA = 'stream_delta'</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u6d41\u5f0f\u54cd\u5e94\u589e\u91cf\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.EventType.STREAM_END","title":"<code>STREAM_END = 'stream_end'</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u6d41\u5f0f\u54cd\u5e94\u7ed3\u675f\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.EventType.ERROR","title":"<code>ERROR = 'error'</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u9519\u8bef\u3002</p>"},{"location":"api/protocol/chat/#chatevent","title":"ChatEvent","text":""},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent","title":"<code>ChatEvent</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u670d\u52a1\u7aef\u63a8\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u804a\u5929\u4e8b\u4ef6\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent.event","title":"<code>event</code>  <code>instance-attribute</code>","text":"<p>\u4e8b\u4ef6\u7c7b\u578b\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent.message","title":"<code>message = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u5b8c\u6574\u6d88\u606f\uff08MESSAGE / STREAM_END \u65f6\u643a\u5e26\uff09\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent.delta","title":"<code>delta = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u589e\u91cf\u6587\u672c\uff08STREAM_DELTA \u65f6\u643a\u5e26\uff09\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent.error","title":"<code>error = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u9519\u8bef\u4fe1\u606f\uff08ERROR \u65f6\u643a\u5e26\uff09\u3002</p>"},{"location":"api/protocol/chat/#chat_hub_protocol.ChatEvent.request_id","title":"<code>request_id = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u5bf9\u5e94\u8bf7\u6c42\u7684\u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/command/","title":"\u547d\u4ee4\u534f\u8bae","text":"<p>\u5b9a\u4e49\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u7684\u63a7\u5236\u547d\u4ee4\uff0c\u5982\u6e05\u9664\u4e0a\u4e0b\u6587\u3001\u6e05\u9664\u8bb0\u5fc6\u3001\u8bbe\u7f6e\u53c2\u6570\u7b49\u3002</p>"},{"location":"api/protocol/command/#clearcontextcommand","title":"ClearContextCommand","text":""},{"location":"api/protocol/command/#chat_hub_protocol.ClearContextCommand","title":"<code>ClearContextCommand</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u6e05\u9664\u77ed\u671f\u8bb0\u5fc6\uff08\u5f53\u524d\u4f1a\u8bdd\u4e0a\u4e0b\u6587\uff09\u3002</p>"},{"location":"api/protocol/command/#clearmemorycommand","title":"ClearMemoryCommand","text":""},{"location":"api/protocol/command/#chat_hub_protocol.ClearMemoryCommand","title":"<code>ClearMemoryCommand</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u6e05\u9664\u957f\u671f\u8bb0\u5fc6\u3002</p>"},{"location":"api/protocol/command/#setcontextlengthcommand","title":"SetContextLengthCommand","text":""},{"location":"api/protocol/command/#chat_hub_protocol.SetContextLengthCommand","title":"<code>SetContextLengthCommand</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u8bbe\u7f6e\u4e0a\u4e0b\u6587\u6700\u5927\u957f\u5ea6\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.SetContextLengthCommand.length","title":"<code>length</code>  <code>instance-attribute</code>","text":"<p>\u4e0a\u4e0b\u6587\u6700\u5927\u6d88\u606f\u6761\u6570\u3002</p>"},{"location":"api/protocol/command/#commandpayload","title":"CommandPayload","text":""},{"location":"api/protocol/command/#chat_hub_protocol.CommandPayload","title":"<code>CommandPayload</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u547d\u4ee4\u8bf7\u6c42\u8f7d\u8377\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandPayload.bot_id","title":"<code>bot_id</code>  <code>instance-attribute</code>","text":"<p>Bot \u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandPayload.session_id","title":"<code>session_id</code>  <code>instance-attribute</code>","text":"<p>\u4f1a\u8bdd\u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandPayload.command","title":"<code>command</code>  <code>instance-attribute</code>","text":"<p>\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandPayload.request_id","title":"<code>request_id = Field(default_factory=(lambda: uuid4().hex))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u8bf7\u6c42\u552f\u4e00\u6807\u8bc6\uff0c\u7528\u4e8e\u94fe\u8def\u8ffd\u8e2a\u3002</p>"},{"location":"api/protocol/command/#commandresult","title":"CommandResult","text":""},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult","title":"<code>CommandResult</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult.command_type","title":"<code>command_type</code>  <code>instance-attribute</code>","text":"<p>\u56de\u663e\u547d\u4ee4\u7c7b\u578b\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult.success","title":"<code>success</code>  <code>instance-attribute</code>","text":"<p>\u662f\u5426\u6267\u884c\u6210\u529f\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult.data","title":"<code>data = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u547d\u4ee4\u8fd4\u56de\u7684\u6570\u636e\uff08\u5982\u5f53\u524d\u8bbe\u7f6e\u503c\uff09\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult.error","title":"<code>error = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u5931\u8d25\u65f6\u7684\u9519\u8bef\u4fe1\u606f\u3002</p>"},{"location":"api/protocol/command/#chat_hub_protocol.CommandResult.request_id","title":"<code>request_id = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u5bf9\u5e94\u8bf7\u6c42\u7684\u552f\u4e00\u6807\u8bc6\u3002</p>"},{"location":"api/protocol/message/","title":"\u6d88\u606f\u7c7b\u578b","text":"<p>\u652f\u6301\u6587\u672c\u3001\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u3001\u6587\u4ef6\u7b49\u591a\u79cd\u6d88\u606f\u7c7b\u578b\uff0c\u4f7f\u7528 discriminated union \u5b9e\u73b0\u7c7b\u578b\u5b89\u5168\u7684\u591a\u6001\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u3002</p>"},{"location":"api/protocol/message/#textsegment","title":"TextSegment","text":""},{"location":"api/protocol/message/#chat_hub_protocol.TextSegment","title":"<code>TextSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u6587\u672c\u6d88\u606f\u6bb5\u3002</p>"},{"location":"api/protocol/message/#imagesegment","title":"ImageSegment","text":""},{"location":"api/protocol/message/#chat_hub_protocol.ImageSegment","title":"<code>ImageSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u56fe\u7247\u6d88\u606f\u6bb5\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.ImageSegment.url","title":"<code>url</code>  <code>instance-attribute</code>","text":"<p>\u56fe\u7247\u5730\u5740\uff08URL \u6216 base64 data URI\uff09\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.ImageSegment.alt","title":"<code>alt = ''</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u56fe\u7247\u66ff\u4ee3\u6587\u672c\u3002</p>"},{"location":"api/protocol/message/#audiosegment","title":"AudioSegment","text":""},{"location":"api/protocol/message/#chat_hub_protocol.AudioSegment","title":"<code>AudioSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u97f3\u9891\u6d88\u606f\u6bb5\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.AudioSegment.url","title":"<code>url</code>  <code>instance-attribute</code>","text":"<p>\u97f3\u9891\u5730\u5740\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.AudioSegment.duration","title":"<code>duration = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u65f6\u957f\uff08\u79d2\uff09\u3002</p>"},{"location":"api/protocol/message/#videosegment","title":"VideoSegment","text":""},{"location":"api/protocol/message/#chat_hub_protocol.VideoSegment","title":"<code>VideoSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u89c6\u9891\u6d88\u606f\u6bb5\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.VideoSegment.url","title":"<code>url</code>  <code>instance-attribute</code>","text":"<p>\u89c6\u9891\u5730\u5740\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.VideoSegment.duration","title":"<code>duration = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u65f6\u957f\uff08\u79d2\uff09\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.VideoSegment.cover","title":"<code>cover = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u5c01\u9762\u56fe\u5730\u5740\u3002</p>"},{"location":"api/protocol/message/#filesegment","title":"FileSegment","text":""},{"location":"api/protocol/message/#chat_hub_protocol.FileSegment","title":"<code>FileSegment</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>\u6587\u4ef6\u6d88\u606f\u6bb5\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.FileSegment.url","title":"<code>url</code>  <code>instance-attribute</code>","text":"<p>\u6587\u4ef6\u4e0b\u8f7d\u5730\u5740\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.FileSegment.filename","title":"<code>filename</code>  <code>instance-attribute</code>","text":"<p>\u6587\u4ef6\u540d\u3002</p>"},{"location":"api/protocol/message/#chat_hub_protocol.FileSegment.size","title":"<code>size = None</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>\u6587\u4ef6\u5927\u5c0f\uff08\u5b57\u8282\uff09\u3002</p>"}]}